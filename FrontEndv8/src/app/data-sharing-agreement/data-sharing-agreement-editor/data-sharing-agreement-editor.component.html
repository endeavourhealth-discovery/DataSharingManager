<mat-card>
  <mat-card-header>
    <div mat-card-avatar><mat-icon>lightbulb_outline</mat-icon></div>
    <mat-card-title>Data Sharing Agreement details</mat-card-title>
    <mat-card-subtitle *ngIf="dsa.name">{{dsa.name}}</mat-card-subtitle>
    <mat-card-subtitle *ngIf="!dsa.name">New Data Sharing Agreement</mat-card-subtitle>
    <div fxFlex></div>
    <mat-menu #visualiseMenu="matMenu">
      <button *ngIf="allowEdit" [disabled]="!f.valid"  mat-menu-item (click)="save(false)">Save</button>
      <button *ngIf="allowEdit" [disabled]="!f.valid"  mat-menu-item (click)="save(true)">Save & close</button>
    </mat-menu>
    <div fxLayoutAlign="center" class="mat-action" matRipple>
      <mat-icon [matMenuTriggerFor]="visualiseMenu">more_vert</mat-icon>
    </div>
  </mat-card-header>
  <mat-card-content>
    <form class="form" #f="ngForm" novalidate>
      <div class="form-group" #fgName="ngModelGroup" ngModelGroup="dsa" [class.has-error]="!fgName.valid">
        <div class="flex" fxLayout="row wrap" fxLayout.xs="column" fxLayoutGap="16px grid" fxLayoutAlign="start">
          <mat-form-field appearance="outline" fxFlex="50" fxFill>
            <mat-label>Name</mat-label>
            <input required matInput [(ngModel)]="dsa.name" placeholder="Name" name="name">
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="50" fxFill>
            <mat-label>Description</mat-label>
            <input required matInput [(ngModel)]="dsa.description" placeholder="Description" name="description">
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="25" fxFill>
            <mat-label>Status</mat-label>
            <mat-select matInput name="status" [(ngModel)]="dsa.dsaStatusId" name="status">
              <mat-option *ngFor="let stat of status" [value]="stat.num">{{stat.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="25" fxFill>
            <mat-label>Processor</mat-label>
            <input required matInput [(ngModel)]="dsa.consentModelId" placeholder="Consent model" name="consentModel">
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="25" fxFill>
            <mat-label>Start Date</mat-label>
            <input matInput type="date" [(ngModel)]="dsa.startDate" placeholder="Start Date" name="startDate">
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="25" fxFill>
            <mat-label>End Date</mat-label>
            <input matInput type="date" [(ngModel)]="dsa.endDate" placeholder="End Date" name="endDate">
          </mat-form-field>
        </div>
        <br>
      </div>
    </form>
    <mat-tab-group dynamicHeight>
      <mat-tab>
        <ng-template mat-tab-label>
          <span matBadge="{{purposes?.length}}" matBadgeOverlap="false" [matBadgeHidden]="purposes?.length < 1">Purposes</span>
        </ng-template>
        <app-generic-table #purposesTable
                           [items]="purposes"
                           [detailsToShow]="purposeDetailsToShow"
                           [allowSelect]="allowEdit"
                           (clicked)="purposeClicked($event)">
          <button role="selectionOnly" *ngIf="allowEdit" mat-icon-button color="warn" (click)="deletePurposes()"><mat-icon>delete</mat-icon></button>
          <button *ngIf="allowEdit" mat-icon-button color="primary" (click)="addPurpose()"><mat-icon>add</mat-icon></button>
        </app-generic-table>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <span matBadge="{{benefits?.length}}" matBadgeOverlap="false" [matBadgeHidden]="benefits?.length < 1">Benefits</span>
        </ng-template>
        <app-generic-table #benefitsTable
                           [items]="benefits"
                           [detailsToShow]="benefitDetailsToShow"
                           [allowSelect]="allowEdit"
                           (clicked)="benefitClicked($event)">
          <button role="selectionOnly" *ngIf="allowEdit" mat-icon-button color="warn" (click)="deleteBenefits()"><mat-icon>delete</mat-icon></button>
          <button *ngIf="allowEdit" mat-icon-button color="primary" (click)="addBenefit()"><mat-icon>add</mat-icon></button>
        </app-generic-table>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <span matBadge="{{regions?.length}}" matBadgeOverlap="false" [matBadgeHidden]="regions?.length < 1">Regions</span>
        </ng-template>
        <app-generic-table #regionsTable
                           [items]="regions"
                           [detailsToShow]="regionDetailsToShow"
                           [allowSelect]="allowEdit"
                           (clicked)="regionClicked($event)">
          <button role="selectionOnly" *ngIf="allowEdit" mat-icon-button color="warn" (click)="deleteRegions()"><mat-icon>delete</mat-icon></button>
          <button *ngIf="allowEdit" mat-icon-button color="primary" (click)="addRegion()"><mat-icon>add</mat-icon></button>
        </app-generic-table>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <span matBadge="{{projects?.length}}" matBadgeOverlap="false" [matBadgeHidden]="projects?.length < 1">Projects</span>
        </ng-template>
        <app-generic-table #projectsTable
                           [items]="projects"
                           [detailsToShow]="projectDetailsToShow"
                           [allowSelect]="allowEdit"
                           (clicked)="projectClicked($event)">
          <button role="selectionOnly" *ngIf="allowEdit" mat-icon-button color="warn" (click)="deleteProjects()"><mat-icon>delete</mat-icon></button>
          <button *ngIf="allowEdit" mat-icon-button color="primary" (click)="addProjects()"><mat-icon>add</mat-icon></button>
        </app-generic-table>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <span matBadge="{{publishers?.length}}" matBadgeOverlap="false" [matBadgeHidden]="publishers?.length < 1">Publishers</span>
        </ng-template>
        <app-generic-table #publishersTable
                           [items]="publishers"
                           [detailsToShow]="publisherDetailsToShow"
                           [allowSelect]="allowEdit"
                           (clicked)="publisherClicked($event)">
          <button role="selectionOnly" *ngIf="allowEdit" mat-icon-button color="warn" (click)="deletePublishers()"><mat-icon>delete</mat-icon></button>
          <button *ngIf="allowEdit" mat-icon-button color="primary" (click)="addPublisher()"><mat-icon>add</mat-icon></button>
        </app-generic-table>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <span matBadge="{{subscribers?.length}}" matBadgeOverlap="false" [matBadgeHidden]="subscribers?.length < 1">Subscribers</span>
        </ng-template>
        <app-generic-table #subscribersTable
                           [items]="subscribers"
                           [detailsToShow]="subscriberDetailsToShow"
                           [allowSelect]="allowEdit"
                           (clicked)="subscriberClicked($event)">
          <button role="selectionOnly" *ngIf="allowEdit" mat-icon-button color="warn" (click)="deleteSubscribers()"><mat-icon>delete</mat-icon></button>
          <button *ngIf="allowEdit" mat-icon-button color="primary" (click)="addSubscribers()"><mat-icon>add</mat-icon></button>
        </app-generic-table>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <span matBadge="{{documentations?.length}}" matBadgeOverlap="false" [matBadgeHidden]="documentations?.length < 1">Documentations</span>
        </ng-template>
        <app-generic-table #documentationsTable
                           [items]="documentations"
                           [detailsToShow]="documentDetailsToShow"
                           [allowSelect]="allowEdit"
                           (clicked)="documentationClicked($event)">
          <button role="selectionOnly" *ngIf="allowEdit" mat-icon-button color="warn" (click)="deleteDocumentations()"><mat-icon>delete</mat-icon></button>
          <button *ngIf="allowEdit" mat-icon-button color="primary" (click)="addDocumentation()"><mat-icon>add</mat-icon></button>
        </app-generic-table>
      </mat-tab>
    </mat-tab-group>
  </mat-card-content>
</mat-card>
