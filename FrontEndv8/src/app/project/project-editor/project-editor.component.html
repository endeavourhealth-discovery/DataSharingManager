<mat-card *ngIf="project">
  <mat-card-header>
    <div mat-card-avatar>
      <i class="fad fa-folders"></i>
    </div>
    <mat-card-title>Project Details</mat-card-title>
    <mat-card-subtitle *ngIf="project.name">{{project.name}}</mat-card-subtitle>
    <mat-card-subtitle *ngIf="!project.name">New Project</mat-card-subtitle>
    <div fxFlex></div>
    <div fxLayoutAlign="center" class="mat-action" matRipple (click)="editProject()">
      <i class="fas fa-fw fa-pencil"></i>
    </div>
    <mat-menu #visualiseMenu="matMenu">
      <button mat-menu-item (click)="close()">Cancel</button>
    </mat-menu>
    <div fxLayoutAlign="center" class="mat-action" matRipple>
      <mat-icon [matMenuTriggerFor]="visualiseMenu">more_vert</mat-icon>
    </div>
  </mat-card-header>
  <mat-card-content>
    <form class="form" #f="ngForm" novalidate>
      <div class="form-group" #fgName="ngModelGroup" ngModelGroup="dpa" [class.has-error]="!fgName.valid">
        <div class="flex" fxLayout="row wrap" fxLayout.xs="column" fxLayoutGap="16px grid" fxLayoutAlign="start">
          <mat-form-field appearance="outline" fxFlex="50" fxFill mat-readonly>
            <mat-label>Project name</mat-label>
            <input required matInput [(ngModel)]="project.name" placeholder="Project name" name="name" readonly>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="50" fxFill mat-readonly>
            <mat-label>Business case</mat-label>
            <mat-select matInput name="status" [(ngModel)]="project.businessCaseStatus" name="businessCaseStatus" readonly>
              <mat-option *ngFor="let bc of businessCaseStatuses" [value]="bc.num">{{bc.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="50" fxFill mat-readonly>
            <mat-label>Summary</mat-label>
            <textarea matInput [(ngModel)]="project.summary" placeholder="Summary" name="summary" rows="6" readonly></textarea>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="50" fxFill mat-readonly>
            <mat-label>Objectives</mat-label>
            <textarea matInput [(ngModel)]="project.objectives" placeholder="Objectives" name="objectives" rows="6" readonly></textarea>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="50" fxFill mat-readonly>
            <mat-label>Project lead</mat-label>
            <mat-select matInput name="status" [(ngModel)]="project.leadUser" name="leadUser" readonly>
              <mat-option *ngFor="let leadUser of userList" [value]="leadUser.uuid">{{leadUser.forename}} {{leadUser.surname}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="50" fxFill mat-readonly>
            <mat-label>Project technical lead</mat-label>
            <mat-select matInput name="status" [(ngModel)]="project.technicalLeadUser" name="technicalLeadUser" readonly>
              <mat-option *ngFor="let techUser of userList" [value]="techUser.uuid">{{techUser.forename}} {{techUser.surname}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="33" fxFill mat-readonly>
            <mat-label>Storage protocol</mat-label>
            <mat-select matInput name="status" [(ngModel)]="project.storageProtocolId" name="storageProtocolId" readonly>
              <mat-option *ngFor="let sps of storageProtocols" [value]="sps.num">{{sps.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="33" fxFill mat-readonly>
            <mat-label>Patient consent model</mat-label>
            <mat-select matInput name="status" [(ngModel)]="project.consentModelId" name="consentModel" readonly>
              <mat-option *ngFor="let con of consents" [value]="con.num">{{con.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="34" fxFill mat-readonly>
            <mat-label>De-identification level</mat-label>
            <mat-select matInput name="status" [(ngModel)]="project.deidentificationLevel" name="deIdentificationLevel" readonly>
              <mat-option *ngFor="let did of deidentificationLevel" [value]="did.num">{{did.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="33" fxFill mat-readonly>
            <mat-label>Project type</mat-label>
            <mat-select matInput name="status" [(ngModel)]="project.projectTypeId" name="projectTypeId" readonly>
              <mat-option *ngFor="let proj of projectTypes" [value]="proj.num">{{proj.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="33" fxFill mat-readonly>
            <mat-label>Frequency</mat-label>
            <mat-select matInput name="status" [(ngModel)]="project.flowScheduleId" name="flowScheduleId" readonly>
              <mat-option *ngFor="let fs of flowScheduleIds" [value]="fs.num">{{fs.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="34" fxFill mat-readonly>
            <mat-label>Output format</mat-label>
            <mat-select matInput name="status" [(ngModel)]="project.outputFormat" name="outputFormat" readonly>
              <mat-option *ngFor="let of of outputFormat" [value]="of.num">{{of.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="33" fxFill mat-readonly>
            <mat-label>Application Policy</mat-label>
            <mat-select matInput name="status" [(ngModel)]="selectedApplicationPolicy" name="selectedApplicationPolicy" (selectionChange)="changeUserApplicationPolicy(selectedApplicationPolicy.id)" readonly>
              <mat-option *ngFor="let pol of availablePolicies" [value]="pol">{{pol.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="33" fxFill mat-readonly>
            <mat-label>Security infrastructure Id</mat-label>
            <mat-select matInput name="status" [(ngModel)]="project.securityInfrastructureId" name="securityInfrastructureId" readonly>
              <mat-option *ngFor="let sec of securityInfrastructures" [value]="sec.num">{{sec.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="34" fxFill mat-readonly>
            <mat-label>Security architectures Id</mat-label>
            <mat-select matInput name="status" [(ngModel)]="project.securityArchitectureId" name="securityArchitectureId" readonly>
              <mat-option *ngFor="let arc of securityArchitectures" [value]="arc.num">{{arc.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="33" fxFill mat-readonly>
            <mat-label>Status</mat-label>
            <mat-select matInput name="status" [disabled]="disableStatus" [(ngModel)]="project.projectStatusId" name="projectStatusId" readonly>
              <mat-option *ngFor="let stat of status" [value]="stat.num">{{stat.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="33" fxFill mat-readonly>
            <mat-label>Start date</mat-label>
            <input matInput type="date" [(ngModel)]="project.startDate" placeholder="Start date" name="startDate" readonly>
          </mat-form-field>
          <mat-form-field appearance="outline" fxFlex="34" fxFill mat-readonly>
            <mat-label>End date</mat-label>
            <input matInput type="date" [(ngModel)]="project.endDate" placeholder="End date" name="endDate" readonly>
          </mat-form-field>
        </div>
        <br>
      </div>
    </form>
    <mat-tab-group dynamicHeight>
      <mat-tab>
        <ng-template mat-tab-label>
          <span matBadge="{{dsas?.length}}" matBadgeOverlap="false" [matBadgeHidden]="dsas?.length < 1">Sharing agreements</span>
        </ng-template>
        <app-generic-table #dsasTable
                           [items]="dsas"
                           [detailsToShow]="dsasDetailsToShow"
                           [allowSelect]="allowEdit"
                           (clicked)="dsaClicked($event)">
          <button role="selectionOnly" *ngIf="allowEdit" mat-icon-button color="warn" (click)="deleteDsas()"><mat-icon>delete</mat-icon></button>
          <button *ngIf="allowEdit" mat-icon-button color="primary" (click)="addDsas()"><mat-icon>add</mat-icon></button>
        </app-generic-table>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <span matBadge="{{publishers?.length}}" matBadgeOverlap="false" [matBadgeHidden]="publishers?.length < 1">Publishers</span>
        </ng-template>
        <app-generic-table #publishersTable
                           [items]="publishers"
                           [detailsToShow]="publishersDetailsToShow"
                           [allowSelect]="allowEdit"
                           (clicked)="publisherClicked($event)">
          <button role="selectionOnly" *ngIf="allowEdit" mat-icon-button color="warn" (click)="deletePublishers()"><mat-icon>delete</mat-icon></button>
          <button *ngIf="allowEdit" mat-icon-button color="primary" (click)="addPublishers()"><mat-icon>add</mat-icon></button>
        </app-generic-table>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <span matBadge="{{subscribers?.length}}" matBadgeOverlap="false" [matBadgeHidden]="subscribers?.length < 1">Subscribers</span>
        </ng-template>
        <app-generic-table #subscribersTable
                           [items]="subscribers"
                           [detailsToShow]="publishersDetailsToShow"
                           [allowSelect]="allowEdit"
                           (clicked)="publisherClicked($event)">
          <button role="selectionOnly" *ngIf="allowEdit" mat-icon-button color="warn" (click)="deleteSubscribers()"><mat-icon>delete</mat-icon></button>
          <button *ngIf="allowEdit" mat-icon-button color="primary" (click)="addSubscribers()"><mat-icon>add</mat-icon></button>
        </app-generic-table>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <span matBadge="{{documentations?.length}}" matBadgeOverlap="false" [matBadgeHidden]="documentations?.length < 1">Documentations</span>
        </ng-template>
        <app-generic-table #documentationsTable
                           [items]="documentations"
                           [detailsToShow]="documentationsDetailsToShow"
                           [allowSelect]="allowEdit"
                           (clicked)="documentationClicked($event)">
          <button role="selectionOnly" *ngIf="allowEdit" mat-icon-button color="warn" (click)="deleteDocumentations()"><mat-icon>delete</mat-icon></button>
          <button *ngIf="allowEdit" mat-icon-button color="primary" (click)="addDocumentation()"><mat-icon>add</mat-icon></button>
        </app-generic-table>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <span matBadge="{{cohorts?.length}}" matBadgeOverlap="false" [matBadgeHidden]="cohorts?.length < 1">Cohorts</span>
        </ng-template>
        <app-generic-table #cohortsTable
                           [items]="cohorts"
                           [detailsToShow]="cohortsDetailsToShow"
                           [allowSelect]="allowEdit"
                           (clicked)="cohortClicked($event)">
          <button role="selectionOnly" *ngIf="allowEdit" mat-icon-button color="warn" (click)="deleteCohorts()"><mat-icon>delete</mat-icon></button>
          <button *ngIf="allowEdit" mat-icon-button color="primary" (click)="addCohorts()"><mat-icon>add</mat-icon></button>
        </app-generic-table>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <span matBadge="{{dataSets?.length}}" matBadgeOverlap="false" [matBadgeHidden]="dataSets?.length < 1">Data sets</span>
        </ng-template>
        <app-generic-table #dataSetsTable
                           [items]="dataSets"
                           [detailsToShow]="dataSetsDetailsToShow"
                           [allowSelect]="allowEdit"
                           (clicked)="dataSetClicked($event)">
          <button role="selectionOnly" *ngIf="allowEdit" mat-icon-button color="warn" (click)="deleteDataSets()"><mat-icon>delete</mat-icon></button>
          <button *ngIf="allowEdit" mat-icon-button color="primary" (click)="addDataSets()"><mat-icon>add</mat-icon></button>
        </app-generic-table>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <span matBadge="{{authToShare?.length}}" matBadgeOverlap="false" [matBadgeHidden]="authToShare?.length < 1">Authority to share</span>
        </ng-template>
        <br>
        <br>
        <mat-tab-group dynamicHeight>
          <mat-tab *ngFor="let org of authToShare">
            <ng-template mat-tab-label>
              <span matBadge="{{org.users?.length}}" matBadgeOverlap="false" [matBadgeHidden]="org.users?.length < 1">{{org.organisationName}}</span>
            </ng-template>
            <mat-list>
              <mat-list-item *ngFor="let user of org.users">
                {{user.forename}} {{user.surname}} ({{user.username}})
              </mat-list-item>
            </mat-list>
          </mat-tab>
        </mat-tab-group>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <span matBadge="{{extractTechnicalDetails?.length}}" matBadgeOverlap="false" [matBadgeHidden]="extractTechnicalDetails?.length < 1">Extract technical details</span>
        </ng-template>
        <app-generic-table #extractTechnicalDetailsTable
                           [items]="extractTechnicalDetails"
                           [detailsToShow]="extractTechnicalDetailToShow"
                           [allowSelect]="allowEdit"
                           (clicked)="extractTechnicalDetailClicked($event)">
          <button role="selectionOnly" *ngIf="allowEdit" mat-icon-button color="warn" (click)="deleteExtractTechnicalDetail()"><mat-icon>delete</mat-icon></button>
          <button *ngIf="allowEdit && extractTechnicalDetails?.length < 1" mat-icon-button color="primary" (click)="addExtractTechnicalDetail()"><mat-icon>add</mat-icon></button>
        </app-generic-table>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <span matBadge="{{schedules?.length}}" matBadgeOverlap="false" [matBadgeHidden]="schedules?.length < 1">Scheduler</span>
        </ng-template>
        <app-generic-table #schedulesTable
                           [items]="schedules"
                           [detailsToShow]="schedulesDetailsToShow"
                           [allowSelect]="allowEdit"
                           (clicked)="scheduleClicked($event)">
          <button role="selectionOnly" *ngIf="allowEdit" mat-icon-button color="warn" (click)="deleteSchedules()"><mat-icon>delete</mat-icon></button>
          <button *ngIf="allowEdit && schedules?.length < 1" mat-icon-button color="primary" (click)="addSchedule()"><mat-icon>add</mat-icon></button>
        </app-generic-table>
      </mat-tab>
    </mat-tab-group>
  </mat-card-content>
</mat-card>
